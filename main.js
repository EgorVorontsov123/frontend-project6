(()=>{"use strict";function e(e,t,n){var o=e.querySelector(".".concat(t.name,"-input-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}function t(t,n,o){n.validity.valid?e(t,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.name,"-input-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,n,n.validationMessage,o)}function n(e){return e.some((function(e){return!e.validity.valid}))}function o(e,t,o){n(e)?t.classList.add(o.inactiveButtonClass):t.classList.remove(o.inactiveButtonClass)}function r(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function c(t,n){t.classList.add("popup_is-opened"),document.addEventListener("keydown",r),function(t,n){var r=t.querySelector(".popup__button");if(r){var c=Array.from(t.querySelectorAll(n.inputSelector));o(c,r,n);var u=t.querySelector(n.formSelector);c.forEach((function(t){e(u,t,n)}))}}(t,n)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}var a,i,l,s,p={baseUrl:"https://nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"2d490241-2df9-492b-a3c7-54620beb7a0e","Content-Type":"application/json"}};function d(e){return e.then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function _(e,t){return d(fetch("".concat(t.baseUrl,"/").concat(e),{headers:t.headers}))}function f(e,t,n){return d(fetch("".concat(t.baseUrl,"/").concat(e),{headers:t.headers,method:n.method,body:n.body}))}function v(e,t,n,o,r,u,s){var d=a.cloneNode(!0);d.querySelector(".card__title").textContent=t;var _=d.querySelector(".card__image");_.src=n,_.alt=t,_.addEventListener("click",(function(){i.src=n,i.alt=t,l.textContent=t,c(o)}));var v=d.querySelector(".card__likes_button");s.forEach((function(e){e._id==u&&v.classList.add("card__likes_button_is-active")}));var m=d.querySelector(".card__likes_counter");m.textContent=s.length,v.addEventListener("click",(function(){var t;v.classList.contains("card__likes_button_is-active")?(t=e,f("cards/likes/".concat(t),p,{method:"DELETE"})).then((function(e){m.textContent=e.likes.length,v.classList.remove("card__likes_button_is-active")})).catch((function(e){return console.log(e)})):function(e){return f("cards/likes/".concat(e),p,{method:"PUT"})}(e).then((function(e){m.textContent=e.likes.length,v.classList.add("card__likes_button_is-active")})).catch((function(e){return console.log(e)}))}));var y=d.querySelector(".card__delete-button");return r==u?y.addEventListener("click",(function(){var t;(t=e,f("cards/".concat(t),p,{method:"DELETE"})).then((function(){return d.remove()})).catch((function(e){return console.log(e)}))})):d.removeChild(y),d}var m,y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_state_error",errorClass:"popup__input-error_visible"};m=y,Array.from(document.querySelectorAll(m.formSelector)).forEach((function(e){!function(e,r){var c=Array.from(e.querySelectorAll(r.inputSelector)),u=e.querySelector(r.submitButtonSelector);c.forEach((function(n){n.addEventListener("input",(function(){o(c,u,r),t(e,n,r)}))})),e.addEventListener("submit",(function(o){n(c)&&(o.preventDefault(),o.stopImmediatePropagation(),c.forEach((function(n){t(e,n,r)})))}))}(e,m)}));var S=document.querySelector(".places__list"),h=document.querySelector("#card-template").content.querySelector(".card"),q=document.querySelector(".popup_type_image"),b=q.querySelector(".popup__image"),E=q.querySelector(".popup__caption"),L=q.querySelector(".popup__close"),C=document.querySelector(".popup_type_edit"),k=document.querySelector(".profile__edit-button"),g=C.querySelector(".popup__input_type_name"),x=C.querySelector(".popup__input_type_description"),w=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),T=C.querySelector(".popup__close"),D=C.querySelector(".popup__form"),B=C.querySelector(".popup__button"),N=document.querySelector(".popup_type_edit-avatar"),O=N.querySelector(".popup__form"),U=N.querySelector(".popup__close"),j=N.querySelector(".popup__input_type_url"),I=N.querySelector(".popup__button"),J=document.querySelector(".popup_type_new-card"),H=document.querySelector(".profile__add-button"),z=J.querySelector(".popup__close"),M=J.querySelector(".popup__form"),F=J.querySelector(".popup__input_type_card-name"),G=J.querySelector(".popup__input_type_url"),K=J.querySelector(".popup__button");function Q(){u(J),F.value="",G.value=""}a=h,i=b,l=E,q.addEventListener("mousedown",(function(e){e.target==q&&u(q)})),L.addEventListener("click",(function(){u(q)})),P.addEventListener("click",(function(){c(N,y)})),O.addEventListener("submit",(function(e){var t;e.preventDefault(),I.textContent="Сохранение...",(t=j.value,f("users/me/avatar",p,{method:"PATCH",body:JSON.stringify({avatar:t})})).then((function(e){P.style.backgroundImage="url('".concat(e.avatar,"')"),u(N),j.value=""})).catch((function(e){return console.log(e)})).finally((function(){I.textContent="Сохранение"}))})),U.addEventListener("click",(function(){return u(N)})),N.addEventListener("mousedown",(function(e){e.target==N&&u(N)})),k.addEventListener("click",(function(){g.value=w.textContent,x.value=A.textContent,c(C,y)})),C.addEventListener("mousedown",(function(e){e.target==C&&u(C)})),T.addEventListener("click",(function(){u(C)})),D.addEventListener("submit",(function(e){var t,n;e.preventDefault(),B.textContent="Сохранение...",(t=g.value,n=x.value,f("users/me",p,{method:"PATCH",body:JSON.stringify({name:t,about:n})})).then((function(e){w.textContent=e.name,A.textContent=e.about,u(C)})).catch((function(e){return console.log(e)})).finally((function(){B.textContent="Сохранение"}))})),J.addEventListener("mousedown",(function(e){e.target==J&&Q()})),H.addEventListener("click",(function(){c(J,y)})),z.addEventListener("click",Q),M.addEventListener("submit",(function(e){var t,n;e.preventDefault(),K.textContent="Сохранение...",(t=F.value,n=G.value,f("cards",p,{method:"POST",body:JSON.stringify({name:t,link:n})})).then((function(e){var t=v(e._id,e.name,e.link,q,e.owner._id,s,e.likes);S.prepend(t),Q()})).catch((function(e){return console.log(e)})).finally((function(){return K.textContent="Сохранение"}))})),Promise.all([_("users/me",p),_("cards",p)]).then((function(e){var t=e[0],n=e[1];s=t._id,w.textContent=t.name,A.textContent=t.about,P.style.backgroundImage="url('".concat(t.avatar,"')"),n.forEach((function(e){var t=v(e._id,e.name,e.link,q,e.owner._id,s,e.likes);S.append(t)}))})).catch((function(e){return console.log(e)}))})();